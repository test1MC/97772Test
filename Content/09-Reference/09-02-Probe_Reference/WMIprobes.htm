<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="4" MadCap:lastHeight="866" MadCap:lastWidth="576" MadCap:conditions="Primary.Omit" MadCap:fileTags="status_tags.No Changes">
    <head>
    </head>
    <body>
        <h1 class="L2">WMI Probes</h1>
        <p>The WMI probes use the Windows Management Instrumentation (WMI) to query a Windows system to monitor the status of various subsystems.</p>
        <h2>Notes: </h2>
        <ul>
            <li>Certain probes request a significant amount of information, and may take longer than the default timeout period. For those probes, you may need to set the probe's timeout to a higher value. Use the probe's timeout parameter to specify a timeout other than the default. This setting overrides the default timeout value of 3 seconds, as well as the value set using the Monitor menu's <b style="font-style: italic;">Set Timeout...</b> command.</li>
            <li>Some probes require additional permissions. InterMapper currently uses the credentials from the NT&#160;Services &amp; WMI pane of the  Server Settings panel.</li>
            <li>WMI probes are visible only from a Windows-based InterMapper server.</li>
        </ul>
        <h2>Available WMI Probes</h2>
        <ul>
            <li><b><a href="#cpu_util">WMI CPU Utilization<MadCap:xref href="#cpu_util" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - checks the percentage of time that the processor is executing a non-idle thread on the target host.</li>
            <li><b><a href="#disk_space">WMI Disk Available<MadCap:xref href="#disk_space" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - checks the disk space available on a drive on the target host. </li>
            <li><b><a href="#disk_frag">WMI Disk Defragmentation<MadCap:xref href="#disk_frag" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - gets analysis information about disk fragmentation on a drive on the target host.</li>
            <li><b><a href="#event_log">WMI Event Log<MadCap:xref href="#event_log" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - retrieves entries from the Event Logs on the target host.</li>
            <li><b><a href="#file_check">WMI File Check<MadCap:xref href="#file_check" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - checks files on the target host using the parameters you provide.</li>
            <li><b><a href="#folder_check">WMI Folder Check<MadCap:xref href="#folder_check" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - checks folder on the target host. using the parameters you provide.</li>
            <li><b><a href="#free_mem">WMI Free Memory<MadCap:xref href="#free_mem" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - checks the amount of physical memory available to processes running on the target host</li>
            <li><b><a href="#net_util">WMI Network Utilization<MadCap:xref href="#net_util" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - checks the network utilization on an interface on the target host.</li>
            <li><b><a href="#proc_mon">WMI Process Monitor<MadCap:xref href="#proc_mon" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - gets information about processes running on the target host.</li>
            <li MadCap:conditions=""><b><a href="#sys_inv">System Information<MadCap:xref href="#sys_inv" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - collects a variety of information about the monitored host, including hardware and operating system details.</li>
            <li MadCap:conditions=""><b><a href="#inst_sw">Installed software<MadCap:xref href="#inst_sw" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - retrieves information about software installed on the target host.</li>
            <li MadCap:conditions=""><b><a href="#loggedin_users">Logged-on users<MadCap:xref href="#loggedin_users" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - retrieves information about users logged on to the target host.</li>
            <li MadCap:conditions=""><b><a href="#exch_server">MSExchange 2007 Hub Transport Server<MadCap:xref href="#exch_server" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - retrieves performance information about the delivery queues on a MS Exchange 2007 Hub Transport Server.</li>
            <li MadCap:conditions=""><b><a href="#exch_server">MSExchange 2007 Mailbox Server<MadCap:xref href="#exch_server" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b>- retrieves performance information about the delivery queues on a MS Exchange 2007 Mailbox Server</li>
            <li MadCap:conditions=""><b><a href="#sql_server">SQL Server 2008 Service Monitor<MadCap:xref href="#sql_server" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - retrieves the state of Microsoft SQL Server 2008 services running on the target host.</li>
            <li><b><a href="#service_mon">WMI Service Monitor<MadCap:xref href="#service_mon" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - checks the state of services running on the target host by querying the Win32_Service class.</li>
            <li><b><a href="#sys_access">WMI System Accessibility<MadCap:xref href="#sys_access" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - tests accessibility of a target device from the monitored host.</li>
            <li><b><a href="#top_proc">WMI Top Processes<MadCap:xref href="#top_proc" target="" title="" alt="" MadCap:conditions="Primary.print" /></a></b> - checks CPU utilization and gets information about processes running on the target host.  </li>
        </ul>
        <p>&#160;</p>
        <h2><a name="cpu_util"></a>WMI CPU Utilization</h2>
        <p>This probe uses WMI to retrieve the percentage of time that the processor is executing a non-idle thread on the target host.  Specifically, it queries the PercentProcessorTime property of the Win32_PerfFormattedData_PerfOS_Processor class and compares it against the Warning and Critical parameters you set.</p>
        <p>The User parameter be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the cpu_util.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <h2><a name="disk_space"></a>WMI Disk Available</h2>
        <p>This probe uses WMI to retrieve the disk space available on a drive on the target host.  Specifically, it queries the Size and FreeSpace properties of the Win32_LogicalDisk class, computes percentage free space, and compares it against the Warning and Critical parameters you set.</p>
        <p>The Drive parameter may be set to "All" to enumerate all Local hard drives on the host.  It may also be set to a list of comma-separated drive names (including the colon), which will be listed whether or not they are local hard drives.  Zero-sized drives (i.e. an empty cd-rom) will not be listed.  The first drive failing the warning or critical criteria will be the one cited in the reason.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the disk_avail.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <p>
        </p>
        <h2><a name="disk_frag"></a>WMI Disk Defragmentation </h2>
        <p>This probe uses WMI to analyze disk fragmentation on a drive on the target host.  Specifically, it calls the DefragAnalysis method of the Win32_Volume class and reports pertinent statistics from the analysis.  If the drive needs to be defragmented, warning status is set for the device.</p>
        <p>The Drive parameter is the drive letter assigned to the local disk to be analyzed, including the colon but without backslashes.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the defrag_analysis.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <h2><a name="event_log"></a>WMI&#160;Event Log </h2>
        <p>This probe uses WMI to retrieve entries from the Event Logs on the target host.  Specifically, it queries the Win32_NTLogEvent class, limiting the search with the parameters you set.  If matching events are found, a critical status is returned.</p>
        <p>The Log File parameter contains a comma-separated list of the logs which are to be searched.  At least one Log File is required.</p>
        <p>The Event Codes parameter is a comma-separated list of event codes for which to search.  Leave it blank to select all codes.</p>
        <p>The Event Types parameter is a comma-separated list of either event type names or the corresponding numerical values.  Names and values can be intermixed.  This limits the selection to events of these types.</p>
        <p>The Hours, Minutes and Seconds parameters combine to define how far back in the event log to search.  These parameters are subtracted from the current time and used to select events based on when they were written to the log.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the event_log.vbs companion script which was placed in the Tools folder of the InterMapper Settings folder when this probe was loaded.</p>
        <h2><a name="file_check"></a>WMI&#160;File Check</h2>
        <p>This probe uses WMI to retrieve information about files on the target host.  Specifically, it queries the CIM_DataFile class, limiting the search with the parameters you set.</p>
        <p>The Path parameter specifies the location of the files you wish to check.  It should include the drive and be enclosed in double-quotes if it contains spaces.</p>
        <p>The File parameter contains the filename and extension of the file you wish to check.  The path will be prepended to it during the final query.  If it is blank, all files in the folder specified by the Path that meet the Size or time criteria will be listed.  File may also be set to a list of comma-separated filenames which will each be prepended by the Path and used as query criteria.</p>
        <p>Wildcards (* ?) may be used in the filename.  If wildcards are used, be sure to specify the Path parameter or the query might take an inordinate amount of time.  At least one of the File or Path parameters must be set.</p>
        <p>The Size parameter defines the minimum file size criteria in bytes.  Any files larger than this value will be listed.  The Hours, Minutes and Seconds parameters combine to define how recently the file had to be changed to be listed.  These parameters are subtracted from the current time and used to select files based on their LastModified value.  At least one of these parameters must be set.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the file_chk.vbs companion script which was placed in the Tools folder of the InterMapper Settings folder when this probe was loaded.  It lists the files which meet your criteria and uses the exit value to set the condition of the device.</p>
        <h2><a name="folder_check"></a>WMI Folder Check</h2>
        <p>This probe uses WMI to retrieve information about a folder on the target host.  Specifically, it queries the Win32_Directory and CIM_DataFile classes to walk the directory tree and accumulate file and folder counts and the total of file sizes.  It also notes the most recently modified file in the tree.</p>
        <p>The Path parameter specifies the folder at the top of the tree which you wish to check.  It should include the drive and be enclosed in double-quotes if it contains spaces.</p>
        <p>Warning and Critical thresholds may be set for the number of folders, the number of files, and the total of the file sizes.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the folder_chk.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It lists the files which meet your criteria and uses the exit value to set the condition of the device.</p>
        <h2><a name="free_mem"></a>WMI Free Memory</h2>
        <p>This probe uses WMI to retrieve the amount of physical memory available to processes running on the target host, in megabytes.  Specifically, it queries the TotalPhysicalMemory property of the Win32_ComputerSystem class.  It also queries the FreePhysicalMemory property of the Win32_OperatingSystem class and compares it against the Warning and Critical parameters you set.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the free_mem.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <h2 MadCap:conditions=""><a name="sys_inv"></a>System Information</h2>
        <p>This probe uses WMI to collect a variety of information about the monitored host, including hardware and operating system details.  The target host must be running Windows 2000 or later.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the system_info.vbs VB script which, must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <h2 MadCap:conditions=""><a name="inst_sw"></a>Installed software </h2>
        <p>This probe uses WMI to retrieve information about software installed on the target host.  Specifically, it queries the Win32_Product class for information about products installed using Windows Installer.  It also queries Win32_OperatingSystem and displays the operating system name, version and service pack level.</p>
        <p>The target host must be running Windows XP, Windows Server 2003 or later.  </p>
        <p><b>Note:</b> On Windows Server 2003, the Win32_Product class isn't always installed by default.  You can install the "WMI Windows Installer Provider" component under "Management and Monitoring Tools" in "Add/Remove Windows Components".</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the installed_sofware.vbs VB script which is embedded in this probe and ultimately resides in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device.</p>
        <h2 MadCap:conditions=""><a name="loggedin_users"></a>Logged-on users</h2>
        <p>This probe uses WMI to retrieve information about users logged on to the target host.  Specifically, it queries the LogonType and StartTime properties of the Win32_LogonSession class, limiting the selection to those in the comma-separated list of numeric Logon Types you set in the Type parameter.  It queries instances of the Win32_LoggedOnUser class, matches the LogonID and extracts the user's name and domain from the path of the Win32_Account.  The target host must be running Windows XP, Windows Server 2003 or later.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the log_users.vbs VB script which is embedded as a companion script in this probe file.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <h2 MadCap:conditions=""><a name="exch_hub_xport"></a>MSExchange 2007 Hub Transport Server </h2>
        <p>This probe uses WMI to retrieve performance information about the delivery queues on a MS Exchange 2007 Hub Transport Server.  Specifically, it queries the Win32_PerfFormattedData_MSExchangeTransportQueues_MSExchangeTransportQueues class to collect a variety of queue statistics and then compares them to the criteria you set.  The default criteria for warning and critical conditions are taken from the Microsoft TechNet article <a href="http://technet.microsoft.com/en-us/library/bb201704.aspx" target="_blank">Monitoring Hub Transport Servers</a>.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\\user" for a domain login.  Leave it blank if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the ex07_transport.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device.</p>
        <h2 MadCap:conditions=""><a name="exch_mailbox_server"></a>MSExchange 2007 Mailbox Server&#160;</h2>
        <p>This probe uses WMI to retrieve performance information about the delivery queues on a MS Exchange 2007 Mailbox Server.  Specifically, it queries the Win32_PerfFormattedData_MSExchangeIS_MSExchangeIS, Win32_PerfFormattedData_MSExchangeIS_MSExchangeISMailbox, Win32_PerfFormattedData_MSExchangeIS_MSExchangeISPublic, Win32_PerfFormattedData_MSExchangeSearchIndices_MSExchangeSearchIndices classes to collect a variety of statistics and then compares them to the criteria you set.  The default criteria for warning and critical conditions are taken from the Microsoft TechNet article <a href="http://technet.microsoft.com/en-us/library/bb201689.aspx" target="_blank">Monitoring Mailbox Servers</a>.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\\user" for a domain login. Leave it blank if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the ex07_mailbox.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory. It uses the exit value to set the condition of the device.</p>
        <h2 MadCap:conditions=""><a name="sql_server"></a>SQL Server 2008 Service Monitor</h2>
        <p MadCap:conditions="">This probe uses WMI to retrieve the state of Microsoft SQL Server 2008 services running on the target host by querying the Win32_Service class. Use the checkboxes to select the services which you want this probe to monitor. The states of the selected services are listed, and if any are not running, the status of the device is set to Critical. The target host must be running Windows 2000 or later.</p>
        <p>The Instance parameter specifies the SQL Server instance you wish to monitor on the target host. If you wish to monitor the default instace you should leave this blank.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\\user" for a domain login. Leave it blank if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the sql2k8_serv_mon.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory. It uses the exit value to set the condition of the device.</p>
        <h2><a name="net_util"></a>WMI&#160;Network Utilization </h2>
        <p>This probe uses WMI to retrieve the network utilization on an interface on the target host.  Specifically, it queries the BytesTotalPersec, CurrentBandwidth, OutputQueueLength and PacketsReceivedErrors properties of the Win32_PerfFormattedData_Tcpip_NetworkInterface class.  It compares OutputQueueLength against the Warning and Critical parameters you set.</p>
        <p>The interface may be selected by IP Address, MAC Address, or Index.  You may use colons, hyphens or no separators when specifying a MAC address.  The interface name is queried from the Win32_NetworkAdapterConfiguration class and used to query data from the Win32_PerfFormattedData_Tcpip_NetworkInterface class.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the net_util.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <h2><a name="proc_mon"></a>WMI Process Monitor </h2>
        <p>This probe uses WMI to retrieve information about processes running on the target host.  Specifically, it queries the PercentProcessorTime properties of the Win32_PerfFormattedData_PerfProc_Process class and compares it against the Warning and Critical parameters you set.  Any of the specified processes that are not found are listed and the status is set to Critical</p>
        <p>The Process parameter is set to a comma-separated list of process names to check.  Extensions are not included in the process names.  Names containing spaces or other special characters should be enclosed in quotes.  If multiple processes match the name, they will all be listed.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the proc_mon.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <h2><a name="service_mon"></a>WMI&#160;Service Monitor</h2>
        <p>This probe uses WMI to retrieve the state of services running on the target host by querying the Win32_Service class.  Any of the specified services that are not found are listed and the status is set to Critical</p>
        <p>The Service parameter is set to a comma-separated list of service names to check.  Names containing spaces or other special characters should be enclosed in quotes.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the serv_mon.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device.</p>
        <h2><a name="sys_access"></a>WMI System Accessibility </h2>
        <p>This probe uses WMI to test accessibilty of a target device from the monitored host.  Specifically, it uses the Win32_PingStatus class to test the connectivity and returns a response time which is chartable.  If the target cannot be pinged, the status is set to critical and a discontinuity is inserted in the chart data.</p>
        <p>Additional information about the monitored host is queried from the Win32_NetworkAdapterConfiguration and Win32_NTDomain classes and displayed in the status window.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the sys_access.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <h2><a name="top_proc"></a>WMI Top Processes </h2>
        <p>This probe uses WMI to retrieve information about CPU utilization and processes running on the target host.  Specifically, it queries the PercentProcessorTime property of the Win32_PerfFormattedData_PerfOS_Processor class and compares it against the Warning and Critical parameters you set.  It queries the PercentProcessorTime properties of the Win32_PerfFormattedData_PerfProc_Process class and lists up to five processes using the most CPU time.  Because there is a time lapse between collecting the CPU data and the process data, the reported values will not add up exactly.</p>
        <p>The User parameter may be a local user on the target host, or may take the form of "domain\user" for a domain login.  Set it to "None" if authentication is not required, such as when the target is the localhost.</p>
        <p>InterMapper invokes the top_cpu.vbs VB script which must reside in the Tools sub-directory of the InterMapper Settings directory.  It uses the exit value to set the condition of the device and the performance data returned by the script to create a nice display of chartable data.</p>
        <p>&#160;</p>
    </body>
</html>